<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/output.css">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="/alert/sweetalert2.css">
  <title>Index</title>
</head>

<body class="bg-gray-100">

  <%- include('template/navbar') %>

   
      <!-- left Side Start -->
      <div class="w-full p-4 sm:p-8 md:p-12 lg:p-16 xl:p-20">
        <h1 class="mb-4 text-4xl font-extrabold leading-none tracking-tight text-gray-900 md:text-5xl lg:text-6xl dark:text-white text-center">Üretim Girişi</h1>
        <!-- Left Top Start -->
        <div class=" my-10 flex items-center justify-center">
          
          <div class="bg-white p-4 md:p-8 lg:p-12 xl:p-16 rounded-lg shadow-md w-full md:w-1/2">
 



            <form id="productionInputForm">
              <label for="date" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Tarih</label>
              <div class="relative  mb-5">

                <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                  <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z" />
                  </svg>
                </div>

                <input datepicker datepicker-autohide type="text" autocomplete="off" id="date"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                  placeholder="Tarih Seçiniz">
              </div>
              <label for="machineNumber" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Makine
                Numarası Seçiniz</label>
              <select id="machineNumber"
                class="bg-gray-50 border border-gray-300 mb-5 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                <option selected>Makine numarası</option>
              </select>

              <label for="machineName" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Makine Adı
                Seçiniz</label>
              <select id="machineName"
                class="bg-gray-50 border border-gray-300 mb-5 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                <option selected>Makine Adı</option>
              </select>

              <label for="productName" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Ürün Adı
                Seçiniz</label>
              <select id="productName"
                class="bg-gray-50 border border-gray-300 mb-5 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                <option selected>Makine Adı</option>

              </select>

              <label for="count" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Üretim
                Adedi</label>
              <input type="number" id="count"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" />




              <div class="mt-5"><button type="submit"
                  class="text-white bg-gradient-to-r from-green-400 via-green-500 to-green-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-green-300 dark:focus:ring-green-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">Oluştur</button>
              </div>
            </form>



          </div>
        </div>
        <!-- Left Top End -->
        <!-- Left Bottom Start -->
        <div class="flex items-center justify-center">
          <div class="bg-white p-8 rounded-lg shadow-md ">


            <div class="relative overflow-x-auto">
              <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                  <tr>
                    <th scope="col" class="px-6 py-3">
                      Üretim Tarihi
                    </th>
                    <th scope="col" class="px-6 py-3">
                      Ürün Adı
                    </th>

                    <th scope="col" class="px-6 py-3">
                      Üretim Adedi
                    </th>
                  </tr>
                </thead>
                <tbody id="tbody">


                </tbody>
              </table>
            </div>

          </div>
        </div>
        <!-- Left Bottom End -->
      </div>

      <!-- Left Side End -->
      <hr class="w-full h-1 mx-auto my-4 bg-gray-200 border-0 rounded md:my-10 dark:bg-gray-700">

      <!-- Right Side Start -->
      <div class="w-full items-center">
        <h1 class="mb-4 text-4xl font-extrabold leading-none tracking-tight text-gray-900 md:text-5xl lg:text-6xl dark:text-white text-center">Üretim Hesaplama</h1>
        
        <div class="my-10 md:my-16 lg:my-20 xl:my-24 flex items-center justify-center">
          <div class="bg-white p-8 rounded-lg shadow-md  text-center items-center" >

            <div date-rangepicker class="flex items-center w-full">
              <div class="relative">
                <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                  <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z" />
                  </svg>
                </div>
                <input name="start" id="start" type="text"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                  placeholder="Başlangıç Tarihi">
              </div>
              <span class="mx-4 text-gray-500">ve</span>
              <div class="relative">
                <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                  <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z" />
                  </svg>
                </div>
                <input name="end" id="end" type="text"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                  placeholder="Bitiş Tarihi">
              </div>
            </div>
            <div class="text-center mt-5">
              <button type="button" id="hesapla"
                class="text-white bg-gray-800 hover:bg-gray-900 focus:outline-none focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-gray-800 dark:hover:bg-gray-700 dark:focus:ring-gray-700 dark:border-gray-700">Göster</button>

            </div>


          </div>
        </div>
        <!-- Right Top End -->

        <!-- Right Bottom Start -->
        <div class="flex items-center justify-center text-center mb-10">
          <div id="toplamUrun" class="bg-white p-8 rounded-lg shadow-md ">


            <div class="relative overflow-x-auto">
              <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                  <tr>
                    <th scope="col" class="px-6 py-3">
                      Üretim Tarihi
                    </th>
                    <th scope="col" class="px-6 py-3">
                      Ürün Adı
                    </th>

                    <th scope="col" class="px-6 py-3">
                      Üretim Adedi
                    </th>
                  </tr>
                </thead>
                <tbody id="tbody2">


                </tbody>
              </table>
            </div>

          </div>
        </div>
      </div>
      <!-- Right Bottom End -->

      <!-- Right Side End -->


  






    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="/flowbite/flowbite.min.js"></script>
    <script src="/flowbite/datepicker.js"></script>
    <script src="/alert/sweetalert2.js"></script>
    <script>
      AOS.init();
    </script>

    <!-- Navbar Toggle Script -->

    <script>
      function createAlert(title, text, icon) {
        Swal.fire({
          title: title,
          text: text,
          icon: icon
        });
      }
      document.getElementById('productionInputForm').addEventListener('submit', function (event) {
        event.preventDefault();
        addProduction();
      });



      addEventListener("DOMContentLoaded", () => {
        getMachineNumber();
        getMachineName();
        getProductName();
        getProduction();
      })
    </script>

    <!-- ADD AND GET DATA SCRIPTS -->
    <script>
function clearInputs() {
  document.getElementById("date").value ="";
  document.getElementById("machineNumber").value ="";
  document.getElementById("machineName").value ="";
  document.getElementById("productName").value ="";
  document.getElementById("count").value ="";
}



      function getMachineNumber() {
        fetch('/admin/get-machine-number')
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {

            let selectElement = document.getElementById('machineNumber');

            data.forEach(item => {
              let option = document.createElement('option');
              option.value = item.makine_numarasi;
              option.text = item.makine_numarasi;
              selectElement.appendChild(option);
            });
          })
          .catch(error => {
            console.error('Error during fetch:', error);
          });
      }
      function getMachineName() {
        fetch('/admin/get-machine-name')
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {

            let selectElement = document.getElementById('machineName');

            data.forEach(item => {
              let option = document.createElement('option');
              option.value = item.makine_ad;
              option.text = item.makine_ad;
              selectElement.appendChild(option);
            });
          })

          .catch(error => {
            console.error('Error during fetch:', error);
          });
      }
      function getProductName() {
        fetch('/admin/get-product-name')
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {


            let selectElement = document.getElementById('productName');

            data.forEach(item => {
              let option = document.createElement('option');
              option.value = item.urun_ad;
              option.text = item.urun_ad;
              selectElement.appendChild(option);
            });
          })

          .catch(error => {
            console.error('Error during fetch:', error);
          });
      }
      function addProduction() {
        let date = document.getElementById('date').value;
        let productName = document.getElementById('productName').value;
        let machineNumber = document.getElementById('machineNumber').value;
        let machineName = document.getElementById('machineName').value;
        let count = document.getElementById('count').value;
        ;
        const data = {
          date: date,
          productName: productName,
          machineName: machineName,
          machineNumber: machineNumber,
          machineName: machineName,
          count: count
        };


        fetch('/admin/add/production', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        })
          .then(response => {
            // Yanıt kontrolü
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {

            createAlert("Başarılı!", "Üretim Kaydı Başarılı.", "success");
            getProduction();
            clearInputs();

          })
          .catch(error => {
            // Hata durumunda
            console.error('Error:', error);
          });


      }
      function getProduction() {
        fetch('/admin/get-production')
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then(data => {
            function formatNumberWithDot(number) {
              return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            }

            let tbody = document.getElementById('tbody');
            tbody.innerHTML= "";
            data.forEach(item => {

              const originalDate = new Date(item.uretim_tarih);


              const formattedDate = originalDate.toLocaleDateString('tr-TR', {
                year: 'numeric',
                month: 'numeric',
                day: 'numeric',

              });

              tbody.innerHTML += `
    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
            ${formattedDate}
        </th>
        <td class="px-6 py-4">
            ${item.urun_ad}
        </td>
     
        <td class="px-6 py-4">
            ${formatNumberWithDot(parseInt(item.uretim_adedi))} 
        </td>
    </tr>
`;

            });
          })
          .catch(error => {
            console.error('Error during fetch:', error);
          });
      }


    </script>

    <script>


      document.getElementById("hesapla").addEventListener("click", () => {
        var tarihDizisi = [];
        function gunleriListele(start, end) {
          var [startGun, startAy, startYil] = start.split('/');
          var [endGun, endAy, endYil] = end.split('/');

          var startDate = new Date(startYil, startAy - 1, startGun);
          var endDate = new Date(endYil, endAy - 1, endGun);




          var timeDifference = endDate.getTime() - startDate.getTime();
          var dayDifference = Math.floor(timeDifference / (1000 * 60 * 60 * 24));


          for (var i = 0; i <= dayDifference; i++) {
            var currentDate = new Date(startDate);
            currentDate.setDate(startDate.getDate() + i);


            tarihDizisi.push(currentDate.toLocaleDateString('tr-TR'));
          }


          var jsonDizi = JSON.stringify(tarihDizisi);


          return jsonDizi;
        }

        // Kullanım örneği
        var start = document.getElementById('start').value;
        var end = document.getElementById('end').value;

        let bodyData = gunleriListele(start, end);

        fetch('/admin/get/product-date', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: bodyData
        })
          .then(response =>
            response.json())
          .then(data => {
            let toplam = 0;
            let tbody2 = document.getElementById('tbody2');
            function formatNumberWithDot(number) {
              return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
            }
            data.forEach(item => {
           

              toplam += parseInt(item.uretim_adedi);
             

              const originalDate = new Date(item.uretim_tarih);


              const formattedDate = originalDate.toLocaleDateString('tr-TR', {
                year: 'numeric',
                month: 'numeric',
                day: 'numeric',

              });

              tbody2.innerHTML += `
              <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
              <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
              ${formattedDate}
              </th>
              <td class="px-6 py-4">
              ${item.urun_ad}
              </td>

              <td class="px-6 py-4">
                ${formatNumberWithDot(parseInt(item.uretim_adedi))} 
              </td>
              </tr>`;
            });
            document.getElementById('toplamUrun').innerHTML += `
  <h4 class="mt-4 text-lg font-extrabold text-gray-900 dark:text-white">Toplam Üretilen Şişe</h4>
  <span class="text-transparent bg-clip-text bg-gradient-to-r to-emerald-600 from-sky-400 text-3xl font-extrabold">${formatNumberWithDot(toplam)}</span>
`;



          })
          .catch();
      })



    </script>



</body>

</html>